<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Тест Множинних Інтелектів</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif; background:#f7f9fc; color:#222; margin: 0; padding: 20px; }
  h1, h2 { color: #004d99; }
  #quiz-container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 12px rgb(0 0 0 / 0.1); }
  .question { margin-bottom: 20px; font-size: 1.1em; }
  .answers label { display: block; margin-bottom: 10px; cursor: pointer; padding: 8px; border-radius: 6px; border: 1px solid #ddd; }
  .answers label:hover { background: #007acc; color: white; }
  .answers input[type="radio"] { margin-right: 10px; }
  #timer { font-size: 1.2em; font-weight: bold; color: #cc3300; margin-bottom: 20px; }
  #next-btn { background: #007acc; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1em; }
  #next-btn:disabled { background: #99c2ff; cursor: not-allowed; }
  #result { max-width: 700px; margin: 30px auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 12px rgb(0 0 0 / 0.1); }
  .tooltip {
    text-decoration: underline;
    color: #007acc;
    cursor: help;
    font-weight: bold;
  }
  .result-item {
    margin-bottom: 15px;
    font-size: 1.1em;
  }
  #export-buttons {
    margin-top: 20px;
  }
  button.export-btn {
    background: #004d99;
    color: white;
    border: none;
    padding: 10px 16px;
    margin-right: 10px;
    border-radius: 6px;
    cursor: pointer;
  }
  button.export-btn:hover {
    background: #003366;
  }
  canvas {
    margin-top: 30px;
    max-width: 100%;
  }
</style>
</head>
<body>

<div id="quiz-container">
  <h1>Тест Множинних Інтелектів</h1>
  <label for="user-age">Вкажіть ваш вік:</label><br />
  <input type="number" id="user-age" min="5" max="100" style="width: 60px; margin-bottom: 15px;" />
  <br />
  <button id="start-btn">Почати тест</button>

  <div id="timer" style="display:none;">Час: <span id="time-left">30</span> сек</div>

  <div id="question-container" style="display:none;">
    <div class="question" id="question-text"></div>
    <div class="answers" id="answers-container"></div>
    <button id="next-btn" disabled>Наступне</button>
  </div>
</div>

<div id="result" style="display:none;">
  <h2>Результати тесту:</h2>
  <div id="result-scores"></div>
  <canvas id="result-chart" width="600" height="400"></canvas>
  <div id="export-buttons">
    <button class="export-btn" id="export-pdf">Експортувати в PDF</button>
    <button class="export-btn" id="export-img">Експортувати як зображення</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
(() => {
  // Питання (тут має бути весь набір твоїх 70 питань з категоріями)
  // Для прикладу поставлю кілька:
  const allQuestions = [
    { id: 1, text: "Я легко запам’ятовую слова і фрази.", category: "Мовленнєвий" },
    { id: 2, text: "Мені подобається розв’язувати логічні задачі.", category: "Логіко-математичний" },
    { id: 3, text: "Я часто наспівую мелодії.", category: "Музичний" },
    { id: 4, text: "Мені подобається займатись спортом.", category: "Тілесно-кінестетичний" },
    { id: 5, text: "Я добре орієнтуюсь на місцевості.", category: "Візуально-просторовий" },
    { id: 6, text: "Я легко розумію настрої інших людей.", category: "Міжособистісний" },
    { id: 7, text: "Я розумію власні почуття і мотиви.", category: "Внутрішньоособистісний" }
    // ... додай всі 70 питань тут, із відповідними категоріями та текстом
  ];

  // Якщо вік < 16, показувати лише ці питання (перелік з твоєї умови)
  const under16AllowedIds = new Set([
    2, 4, 6, 7, 13, 14, 15, 19, 21, 23, 24, 26, 29, 31, 32, 34, 35, 40, 41, 43, 47, 48, 49, 51, 53, 54, 55, 57, 59, 60, 62, 65, 66, 69, 70
  ]);

  // Підписи замість чисел у відповідях
  const answerLabels = {
    1: "Переважно не згоден",
    2: "Частково не згоден",
    3: "Частково згоден",
    4: "Переважно згоден"
  };

  // Опис категорій для tooltip
  const categoryDescriptions = {
    "Мовленнєвий": {
      description: "Слова та мова, писемна і усна; запам’ятовування, інтерпретація та пояснення ідей і інформації через мову, розуміння зв’язку між спілкуванням і значенням.",
      roles: "Письменники, юристи, журналісти, оратори, тренери, копірайтери, викладачі англійської мови, поети, редактори, лінгвісти, перекладачі, PR-консультанти, медіа-консультанти, телеведучі та радіоведучі, диктори.",
      activities: "Написати набір інструкцій; виступити з промовою на тему; редагувати написаний текст або роботу; написати промову; коментувати подію; застосувати позитивне або негативне трактування до історії.",
      learning: "Слова та мова."
    },
    "Логіко-математичний": {
      description: "Логічне мислення, виявлення закономірностей, наукове мислення та дедукція; аналіз проблем, виконання математичних обчислень, розуміння зв’язку між причиною і наслідком для досягнення конкретного результату.",
      roles: "Науковці, інженери, комп’ютерні фахівці, бухгалтери, статистики, дослідники, аналітики, торговці, банкіри, букмекери, страхові брокери, переговорники, укладачі угод, фахівці з вирішення проблем, директори.",
      activities: "Виконати усні арифметичні обчислення; створити процес для вимірювання чогось складного; проаналізувати, як працює машина; розробити процес; розробити стратегію для досягнення мети; оцінити вартість бізнесу або пропозиції.",
      learning: "Числа та логіка."
    },
    "Музичний": {
      description: "Музикальні здібності, усвідомлення, сприйняття та використання звуків; розпізнавання тональних і ритмічних візерунків, розуміння зв’язку між звуком і почуттям.",
      roles: "Музиканти, співаки, композитори, діджеї, музичні продюсери, настройники піаніно, акустичні інженери, артисти, організатори свят, консультанти з навколишнього середовища та шуму, вокальні тренери.",
      activities: "Виконувати музичний твір; співати пісню; рецензувати музичну роботу; навчати когось грати на музичному інструменті; підбирати фонову музику для телефонних систем і приймалень.",
      learning: "Музика, звуки, ритм."
    },
    "Тілесно-кінестетичний": {
      description: "Контроль рухів тіла, мануальна спритність, фізична гнучкість і рівновага; координація очей і тіла.",
      roles: "Танцюристи, демонстратори, актори, спортсмени, дайвери, військові, пожежники, інструктори з фізичної підготовки, артисти виконавці; ергономісти, остеопати, рибалки, водії, ремісники; садівники, кухарі, акупунктуристи, цілителі, авантюристи.",
      activities: "Жонглювати; демонструвати спортивну техніку; кидати підставку для пива; створювати мімічний виступ для пояснення чогось; підкидати млинець; запускати повітряного змія; навчати правильної робочої постави, оцінювати ергономіку робочого місця.",
      learning: "Фізичний досвід і рух, дотик і відчуття."
    },
    "Візуально-просторовий": {
      description: "Візуальне та просторове сприйняття; інтерпретація та створення візуальних образів; образне уявлення та вираження; розуміння зв’язку між образами і значеннями, а також між простором і ефектом.",
      roles: "Художники, дизайнери, мультиплікатори, сценаристи, архітектори, фотографи, скульптори, містобудівники, візіонери, винахідники, інженери, консультанти з косметики та краси.",
      activities: "Спроектувати костюм; інтерпретувати картину; створити план кімнати; розробити корпоративний логотип; спроектувати будівлю; упакувати валізу або багажник автомобіля.",
      learning: "Зображення, форми, образи, тривимірний простір."
    },
    "Міжособистісний": {
      description: "Сприйняття почуттів інших людей; здатність встановлювати зв’язок з іншими; інтерпретація поведінки та спілкування; розуміння взаємин між людьми та їхніми ситуаціями, включно з іншими людьми.",
      roles: "Терапевти, фахівці з людських ресурсів, медіатори, лідери, консультанти, політики, педагоги, продавці, духовенство, психологи, вчителі, лікарі, цілителі, організатори, доглядальники, фахівці з реклами, тренери та наставники.",
      activities: "Інтерпретувати настрій за виразами обличчя; демонструвати почуття за допомогою мови тіла; впливати на почуття інших цілеспрямовано; навчати або консультувати іншу людину.",
      learning: "Людський контакт, спілкування, співпраця, командна робота."
    },
    "Внутрішньоособистісний": {
      description: "Самосвідомість, особисте усвідомлення, особиста об’єктивність, здатність розуміти себе, свої взаємини з іншими і світом, а також власну потребу у змінах і реакцію на них.",
      roles: "Можна стверджувати, що це будь-хто, хто усвідомлює себе і бере участь у процесі зміни особистих думок, переконань і поведінки щодо своєї ситуації, інших людей, своїх цілей і призначення.",
      activities: "Розглянути і визначити власні цілі та необхідні особисті зміни для їх досягнення (не обов’язково відкривати це іншим); розглянути власне 'Вікно Йогарі' та визначити варіанти розвитку; розглянути і визначити власну позицію щодо моделі емоційного інтелекту.",
      learning: "Саморефлексія, самопізнання."
    }
  };

  // DOM-елементи
  const ageInput = document.getElementById("user-age");
  const startBtn = document.getElementById("start-btn");
  const quizContainer = document.getElementById("quiz-container");
  const questionContainer = document.getElementById("question-container");
  const questionText = document.getElementById("question-text");
  const answersContainer = document.getElementById("answers-container");
  const nextBtn = document.getElementById("next-btn");
  const timerDisplay = document.getElementById("timer");
  const timeLeftSpan = document.getElementById("time-left");

  const resultSection = document.getElementById("result");
  const resultScores = document.getElementById("result-scores");
  const resultChartCtx = document.getElementById("result-chart").getContext("2d");
  const exportPdfBtn = document.getElementById("export-pdf");
  const exportImgBtn = document.getElementById("export-img");

  let userAge = 0;
  let questions = [];
  let currentQuestionIndex = 0;
  let scores = {};
  let timer = null;
  let timeLeft = 30;
  let chart = null;

  startBtn.onclick = () => {
    userAge = parseInt(ageInput.value);
    if (!userAge || userAge < 5 || userAge > 100) {
      alert("Будь ласка, введіть вік від 5 до 100.");
      return;
    }

    // Фільтруємо питання згідно з віком
    if (userAge < 16) {
      questions = allQuestions.filter(q => under16AllowedIds.has(q.id));
    } else {
      questions = [...allQuestions];
    }

    if (questions.length === 0) {
      alert("Немає доступних питань для вашого віку.");
      return;
    }

    // Ініціалізація
    currentQuestionIndex = 0;
    scores = {};
    for (const cat of Object.keys(categoryDescriptions)) {
      scores[cat] = 0;
    }

    startBtn.style.display = "none";
    ageInput.disabled = true;
    showQuestion();
    questionContainer.style.display = "block";
    timerDisplay.style.display = "block";
  };

  function showQuestion() {
    nextBtn.disabled = true;
    timeLeft = 30;
    timeLeftSpan.textContent = timeLeft;
    startTimer();

    const q = questions[currentQuestionIndex];
    questionText.textContent = q.text;
    answersContainer.innerHTML = "";

    for (const [value, label] of Object.entries(answerLabels)) {
      const id = `answer-${value}`;
      const labelEl = document.createElement("label");
      labelEl.htmlFor = id;
      labelEl.textContent = label;
      labelEl.style.transition = "background-color 0.3s, color 0.3s";

      const input = document.createElement("input");
      input.type = "radio";
      input.name = "answer";
      input.id = id;
      input.value = value;

      input.onchange = () => {
        nextBtn.disabled = false;
      };

      labelEl.prepend(input);
      answersContainer.appendChild(labelEl);

      // Підсвічування при наведенні: змінити фон і колір
      labelEl.addEventListener("mouseenter", () => {
        labelEl.style.backgroundColor = "#004d99";
        labelEl.style.color = "white";
      });
      labelEl.addEventListener("mouseleave", () => {
        labelEl.style.backgroundColor = "";
        labelEl.style.color = "";
      });
    }
  }

  function startTimer() {
    clearInterval(timer);
    timer = setInterval(() => {
      timeLeft--;
      timeLeftSpan.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timer);
        // Автоматично переходимо до наступного питання з поточним вибором або 0
        if (!document.querySelector('input[name="answer"]:checked')) {
          // Якщо не вибрали, ставимо 1 бал (Переважно не згоден) за замовчуванням
          document.querySelector('input[name="answer"]').checked = true;
        }
        nextBtn.click();
      }
    }, 1000);
  }

  nextBtn.onclick = () => {
    clearInterval(timer);
    const selected = document.querySelector('input[name="answer"]:checked');
    if (!selected) {
      alert("Будь ласка, оберіть відповідь.");
      return;
    }
    const answerValue = parseInt(selected.value);
    const q = questions[currentQuestionIndex];

    scores[q.category] = (scores[q.category] || 0) + answerValue;

    currentQuestionIndex++;
    if (currentQuestionIndex >= questions.length) {
      showResults();
    } else {
      showQuestion();
    }
  };

  function showResults() {
    quizContainer.style.display = "none";
    questionContainer.style.display = "none";
    timerDisplay.style.display = "none";
    resultSection.style.display = "block";

    // Сортуємо за балами спаданням
    const sortedScores = Object.entries(scores)
      .sort((a,b) => b[1] - a[1]);

    resultScores.innerHTML = "";
    for (const [cat, score] of sortedScores) {
      const div = document.createElement("div");
      div.className = "result-item";

      const tooltipText = `
Опис: ${categoryDescriptions[cat]?.description || ""}
Ролі: ${categoryDescriptions[cat]?.roles || ""}
Діяльність: ${categoryDescriptions[cat]?.activities || ""}
Навчання: ${categoryDescriptions[cat]?.learning || ""}
      `.trim();

      const spanCat = document.createElement("span");
      spanCat.textContent = cat + ": ";
      spanCat.className = "tooltip";
      spanCat.title = tooltipText;

      const spanScore = document.createElement("span");
      spanScore.textContent = `${score} балів`;

      div.appendChild(spanCat);
      div.appendChild(spanScore);
      resultScores.appendChild(div);
    }

    drawChart(sortedScores);
  }

  function drawChart(sortedScores) {
    if (chart) {
      chart.destroy();
    }

    chart = new Chart(resultChartCtx, {
      type: "bar",
      data: {
        labels: sortedScores.map(([cat]) => cat),
        datasets: [{
          label: "Бали",
          data: sortedScores.map(([_, score]) => score),
          backgroundColor: "#007acc"
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 1 }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: { enabled: true }
        }
      }
    });
  }

  // Експорт у PDF
  exportPdfBtn.onclick = async () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    let y = 10;
    pdf.setFontSize(16);
    pdf.text("Результати тесту Множинних Інтелектів", 10, y);
    y += 10;

    const sortedScores = Object.entries(scores).sort((a,b) => b[1]-a[1]);
    pdf.setFontSize(12);

    for (const [cat, score] of sortedScores) {
      pdf.text(`${cat}: ${score} балів`, 10, y);
      y += 7;
      if (y > 270) {
        pdf.addPage();
        y = 10;
      }
    }

    // Додати графік у PDF
    const canvas = document.getElementById("result-chart");
    const imgData = canvas.toDataURL("image/png", 1.0);
    pdf.addPage();
    pdf.text("Графік результатів", 10, 10);
    pdf.addImage(imgData, 'PNG', 10, 20, 180, 120);

    pdf.save("result.pdf");
  };

  // Експорт як зображення
  exportImgBtn.onclick = () => {
    const canvas = document.getElementById("result-chart");
    const link = document.createElement("a");
    link.download = "result-chart.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  };
})();
</script>

</body>
</html>
